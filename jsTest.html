<!DOCTYPE html>

<html>
<head>
<meta http-equiv="cahce-control" content="no-cache">
<meta http-equiv="refresh" content="30">
<title>Hermitage Weather</title>
</head>

<body onload="updateImage()"  bgcolor="black">
    <h2>
        <center><font color="blue">Hermitage Weather Station - Release 0.3</font></center>
    </h2>
    <font color="white">
    <pre id="dataDump"><pre>
    <p style="font-size:150%" id="sortedDat">Sorted data goes here</p>

    <table border="0">
    <tr>
        <th>Basic Data</th>
	<th>Wind Data</th>
    </tr>
    <tr>
	<td><p style="font-size:150%" id="temp"><a href="tempf.png">Temp [F]: Unavailable</a></p></td>
	<td><p style="font-size:150%" id="wind"><a href="wind.png">Current Wind [mph]: Unavailable</a></p></td>
    </tr>
    <tr>
	<td><p style="font-size:150%" id="dewpoint"><a href="tempf.png">Dew Point [F]: Unavailable</a></p></td>
	<td><p style="font-size:150%" id="windGust"><a href="wind.png">Current Wind Gust [mph]: Unavailable</a></p></td>
    </tr>
    <tr>
	<td><p style="font-size:150%" id="humidity"><a href="humidity.png">Humidity [%]: Unavailable</a></p></td>
	<td></td>
    </tr>
    <tr>
        <td><p style="font-size:150%" id="pressure"><a href="pressure.png">Atmospheric Pressure [atm]: Unavailable</a></p></td>
        <td></td>
    </tr>

    </table>
<br><Br>
<center>
Image will auto-refresh every 30 seconds<br><br>
</center>
</font>
</body>

<script>

var fileDisplayArea = document.getElementById("dataDump");
var sortedDat = document.getElementById("sortedDat");

var fileText;

function readTextFile(file)
{
    var rawFile = new XMLHttpRequest();
    rawFile.open("GET", file, false);
    rawFile.onreadystatechange = function ()
    {
        if(rawFile.readyState === 4)
        {
            if(rawFile.status === 200 || rawFile.status == 0)
            {
                allText = rawFile.responseText;
        	fileText = alltext
	        // fileDisplayArea.innerText = allText;
		// fileDisplayArea.style.color = "orange";
            }
        }
    }
    rawFile.send(null);
}

readTextFile("./live.txt");

sortedDat.innerText = fileText;
sortedDat.style.color = "red";

var dataList = allText.split(",");

sortedDat.innerText = dataList.length+dataList;
sortedDat.style.color = "yellow";

var dataArr = [];
for (var i = 0; i < dataList.length; i++) {
    sortedDat.innerText = dataList[i];
    sortedDat.style.color = "purple";

    var split = dataList[i].split('=');
    dataArr[split[0].trim()] = split[1].trim();
    }

sortedDat.innerText = dataArr;
sortedDat.style.color = "green";

var temp = dataArr["tempf"];
if (temp < 32){
	document.getElementById("temp").style.color = "blue";}
else if (temp >= 32 && temp < 37){
	document.getElementById("temp").style.color = "yellow";}
else{
	document.getElementById("temp").style.color = "green";}
document.getElementById("temp").innerHTML = "<a href='tempf.png'>Temp:</a> "+temp+" [F]";

var humidity = dataArr["humidity"];
if (humidity > 95){
        document.getElementById("humidity").style.color = "red";}
else if (humidity > 80 && humidity <= 95){
        document.getElementById("humidity").style.color = "yellow";}
else{
        document.getElementById("humidity").style.color = "green";}
document.getElementById("humidity").innerHTML = "<a href='humidity.png'>Humidity:</a> "+humidity+" [%]";

var dewpoint = dataArr["dewpoint"];
var deltaDew = (temp - dewpoint)
if (deltaDew < 5){
        document.getElementById("dewpoint").style.color = "red";}
else if (deltaDew >= 5 && deltaDew < 10){
        document.getElementById("dewpoint").style.color = "yellow";}
else{
        document.getElementById("dewpoint").style.color = "green";}
document.getElementById("dewpoint").innerHTML = "<a href='tempf.png'>Dew Point:</a> "+dewpoint+" [F]";

var pressure = dataArr["pressure"];
document.getElementById("pressure").innerHTML = "<a href='pressure.png'>Atmospheric Pressure:</a> "+dewpoint+" [atm]";
document.getElementById("pressure").style.color = "green";

/*
winddir=270,
windspeedmph=6.4,
windgustmph=14.3,
windgustdir=315,
windspdmph_avg2m=4.1,
winddir_avg2m=256,
windgustmph_10m=12.9,
windgustdir_10m=315
*/
var wind = dataArr["windspdmph_avg2m"];
if (wind > 30){
        document.getElementById("wind").style.color = "red";}
else if (wind > 20 && wind <= 30){
        document.getElementById("wind").style.color = "yellow";}
else{
        document.getElementById("wind").style.color = "green";}
document.getElementById("wind").innerHTML = "<a href='wind.png'>Wind Speed - 2min avg:</a> "+wind+" [mph]";

var windGust = dataArr["windgustmph_10m"];
if (windGust > 45){
        document.getElementById("windGust").style.color = "red";}
else if (wind > 35 && wind <= 45){
        document.getElementById("windGust").style.color = "yellow";}
else{
        document.getElementById("windGust").style.color = "green";}
document.getElementById("windGust").innerHTML = "<a href='wind.png'>Wind Gust - 10min max:</a> "+windGust+" [mph]";

</script>
</html>

